<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Premium handwoven silk saree from Premam Silks.">
    <meta property="og:title" content="Product | Premam Silks">
    <meta property="og:description" content="Premium handwoven silk saree from Premam Silks.">
    <meta property="og:type" content="product">
    <title>Product | Premam Silks</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cart.css">
    <link rel="stylesheet" href="css/product.css">
</head>

<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <p>✨ Free Shipping on Orders Above ₹25,000 | <a href="shop.html">Shop Now</a></p>
    </div>

    <!-- Header -->
    <header class="header" id="header">
        <nav class="nav-container">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="Premam Silks Logo" class="logo-img">
                <div class="logo-text">
                    <span class="logo-name">PREMAM SILKS</span>
                    <span class="logo-tagline">Timeless Sarees • Endless Love</span>
                </div>
            </a>

            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="shop.html" class="nav-link">Sarees</a></li>
                <li><a href="about.html" class="nav-link">About Us</a></li>
                <li><a href="contact.html" class="nav-link">Contact</a></li>
            </ul>

            <div class="nav-icons">
                <button class="nav-icon" id="searchBtn" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
                <a href="#wishlist" class="nav-icon" aria-label="Wishlist">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    <span class="badge">0</span>
                </a>
                <a href="#cart" class="nav-icon" aria-label="Shopping Cart">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    <span class="badge">0</span>
                </a>
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Mobile Navigation -->
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-header">
            <span style="font-family: var(--font-heading); font-size: 1.25rem; font-weight: 500; letter-spacing: 0.15em;">PREMAM SILKS</span>
            <button class="mobile-nav-close" id="mobileNavClose">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        <div class="mobile-nav-links">
            <a href="index.html">Home</a>
            <a href="shop.html">Sarees</a>
            <a href="about.html">About Us</a>
            <a href="contact.html">Contact</a>
        </div>
    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb-section">
        <div class="container">
            <nav class="breadcrumb">
                <a href="index.html">Home</a>
                <span>/</span>
                <a href="shop.html">Sarees</a>
                <span>/</span>
                <span id="breadcrumbName">Loading...</span>
            </nav>
        </div>
    </div>

    <!-- Product Section (populated by JS) -->
    <section class="product-section">
        <div class="container">
            <div id="productContent" style="text-align:center;padding:60px 0;color:#888;">
                <p>Loading product...</p>
            </div>
        </div>
    </section>

    <!-- Product Tabs -->
    <section class="product-tabs-section" id="productTabsSection" style="display:none;">
        <div class="container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="description">Description</button>
                <button class="tab-btn" data-tab="care">Care Instructions</button>
                <button class="tab-btn" data-tab="shipping">Shipping & Returns</button>
            </div>

            <div class="tab-content active" id="description">
                <h3>Product Description</h3>
                <p id="tabDescription">—</p>
            </div>

            <div class="tab-content" id="care">
                <h3>Care Instructions</h3>
                <ul>
                    <li>Dry clean only for best results</li>
                    <li>Store in a cool, dry place wrapped in muslin cloth</li>
                    <li>Avoid direct sunlight to prevent color fading</li>
                    <li>Do not spray perfume directly on the saree</li>
                    <li>Iron on low heat with a cloth in between</li>
                    <li>Refold periodically to prevent permanent creases</li>
                </ul>
            </div>

            <div class="tab-content" id="shipping">
                <h3>Shipping Information</h3>
                <ul>
                    <li>Free shipping on orders above ₹25,000</li>
                    <li>Standard delivery: 5-7 business days</li>
                    <li>Express delivery: 2-3 business days (additional charges apply)</li>
                    <li>International shipping available to 50+ countries</li>
                </ul>
                <h3>Returns & Exchange</h3>
                <ul>
                    <li>2-day return/exchange window from delivery</li>
                    <li>Mandatory unboxing video required for all returns</li>
                    <li>Product must be unused with original tags intact</li>
                    <li>Refund processed within 7-10 business days</li>
                </ul>
                <p style="margin-top:8px;font-size:0.85rem;"><a href="returns.html" style="color:#0d6157;">Check our full Return Policy</a></p>
            </div>
        </div>
    </section>

    <!-- Related Products -->
    <section class="section related-products" id="relatedSection" style="display:none;">
        <div class="container">
            <div class="section-header">
                <span class="tagline">You May Also Like</span>
                <h2>Similar Sarees</h2>
            </div>
            <div class="products-grid" id="relatedGrid"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo footer-logo">
                        <img src="images/logo.png" alt="Premam Silks Logo" class="logo-img footer-logo-img">
                        <span
                            style="font-family: var(--font-heading); font-size: 1.5rem; font-weight: 500; letter-spacing: 0.15em; color: var(--color-white);">PREMAM
                            SILKS</span>
                    </a>
                    <p>Premam Silks brings you the finest handwoven silk sarees, where every thread is woven with love.
                    </p>
                    <div class="footer-social">
                        <a href="https://instagram.com/premam.silks" target="_blank" aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                            </svg>
                        </a>
                        <a href="https://facebook.com/premamsilks" target="_blank" aria-label="Facebook">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z" />
                            </svg>
                        </a>
                        <a href="https://wa.me/917200123457" target="_blank" aria-label="WhatsApp">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654z" />
                            </svg>
                        </a>
                        <a href="https://youtube.com/@premamsilks" target="_blank" aria-label="YouTube">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="footer-column">
                    <h4>Shop</h4>
                    <ul class="footer-links">
                        <li><a href="shop.html">All Sarees</a></li>
                        <li><a href="shop.html#kanjivaram">Kanjivaram</a></li>
                        <li><a href="shop.html#banarasi">Banarasi</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Help</h4>
                    <ul class="footer-links">
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="shipping.html">Shipping</a></li>
                        <li><a href="returns.html">Returns</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Contact</h4>
                    <ul class="footer-links">
                        <li><a href="tel:+917200123457">+91 7200123457</a></li>
                        <li><a href="mailto:premamsilks@gmail.com">premamsilks@gmail.com</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Premam Silks. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float -->
    <a href="https://wa.me/917200123457" target="_blank" class="whatsapp-float"
        style="position: fixed; bottom: 24px; right: 24px; width: 60px; height: 60px; background: #25D366; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4); z-index: 999;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="white">
            <path
                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654z" />
        </svg>
    </a>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/wishlist.js"></script>
    <script src="js/script.js"></script>
    <script>
    (function() {
        function esc(str) { var d = document.createElement('div'); d.textContent = str || ''; return d.innerHTML; }
        function fmt(n) { return '₹' + Number(n).toLocaleString('en-IN'); }

        var params = new URLSearchParams(window.location.search);
        var productId = params.get('id');
        if (!productId) {
            document.getElementById('productContent').innerHTML = '<p>Product not found. <a href="shop.html">Browse all sarees</a></p>';
            return;
        }

        function tryLoad(attempts) {
            if (typeof firebase === 'undefined' || !firebase.apps || !firebase.apps.length) {
                if (attempts < 20) { setTimeout(function() { tryLoad(attempts + 1); }, 300); return; }
                document.getElementById('productContent').innerHTML = '<p>Could not load product. Please try again.</p>';
                return;
            }

            var db = firebase.firestore();
            db.collection('products').doc(productId).get().then(function(doc) {
                if (!doc.exists) {
                    document.getElementById('productContent').innerHTML = '<p>Product not found. <a href="shop.html">Browse all sarees</a></p>';
                    return;
                }

                var p = doc.data();
                var images = p.images && p.images.length > 0 ? p.images : (p.image ? [p.image] : ['images/placeholder.png']);
                var mainImg = images[0];

                // Update page title & breadcrumb
                document.title = (p.name || 'Product') + ' | Premam Silks';
                document.getElementById('breadcrumbName').textContent = p.name || 'Product';

                // Build badges
                var badges = '';
                if (p.badge) badges += '<span class="badge-new">' + esc(p.badge) + '</span>';
                if (p.stock !== undefined && p.stock > 0) badges += '<span class="badge-stock">In Stock</span>';
                else if (p.stock === 0) badges += '<span class="badge-stock" style="background:#fee2e2;color:#991b1b;">Out of Stock</span>';

                // Price
                var priceHtml = '<span class="current-price">' + fmt(p.price) + '</span>';
                if (p.originalPrice && p.originalPrice > p.price) {
                    var discount = Math.round(((p.originalPrice - p.price) / p.originalPrice) * 100);
                    priceHtml += ' <span class="original-price">' + fmt(p.originalPrice) + '</span>';
                    priceHtml += ' <span class="discount">' + discount + '% OFF</span>';
                }

                // Details list
                var details = '';
                if (p.category) details += '<div class="detail-item"><span class="detail-label">Category:</span><span class="detail-value">' + esc(p.category) + '</span></div>';
                if (p.color) details += '<div class="detail-item"><span class="detail-label">Color:</span><span class="detail-value">' + esc(p.color) + '</span></div>';
                if (p.occasion) details += '<div class="detail-item"><span class="detail-label">Occasion:</span><span class="detail-value">' + esc(p.occasion) + '</span></div>';
                if (p.sareeCode) details += '<div class="detail-item"><span class="detail-label">Saree Code:</span><span class="detail-value">' + esc(p.sareeCode) + '</span></div>';

                // Gallery thumbs
                var thumbsHtml = images.map(function(img, i) {
                    return '<button class="thumb' + (i === 0 ? ' active' : '') + '" data-src="' + esc(img) + '"><img src="' + esc(img) + '" alt="View ' + (i+1) + '"></button>';
                }).join('');

                // WhatsApp link
                var productUrl = window.location.href;
                var waMsg = "Hello! I'm interested in this saree:\n\n" +
                    "*" + (p.name || 'Saree') + "*\n" +
                    (p.sareeCode ? "Saree Code: " + p.sareeCode + "\n" : "") +
                    "Price: " + fmt(p.price) + "\n" +
                    (p.category ? "Category: " + p.category + "\n" : "") +
                    "\n" + productUrl;
                var waText = encodeURIComponent(waMsg);

                // Render product
                document.getElementById('productContent').innerHTML = '<div class="product-layout">' +
                    '<div class="product-gallery">' +
                        '<div class="gallery-main"><img src="' + esc(mainImg) + '" alt="' + esc(p.name) + '" id="mainImage"></div>' +
                        (images.length > 1 ? '<div class="gallery-thumbs">' + thumbsHtml + '</div>' : '') +
                    '</div>' +
                    '<div class="product-info-detail">' +
                        (badges ? '<div class="product-badges-detail">' + badges + '</div>' : '') +
                        '<span class="product-category-detail">' + esc(p.category) + '</span>' +
                        '<h1>' + esc(p.name) + '</h1>' +
                        '<div class="product-price-detail">' + priceHtml + '</div>' +
                        (p.description ? '<p class="product-description">' + esc(p.description) + '</p>' : '') +
                        (details ? '<div class="product-details-list">' + details + '</div>' : '') +
                        '<div class="product-actions-detail">' +
                            '<div class="quantity-selector">' +
                                '<button class="qty-btn minus">−</button>' +
                                '<input type="number" value="1" min="1" max="10" class="qty-input">' +
                                '<button class="qty-btn plus">+</button>' +
                            '</div>' +
                            '<button class="btn btn-accent btn-lg add-to-cart" data-product-id="' + doc.id + '" data-product-name="' + esc(p.name) + '" data-product-price="' + (p.price || 0) + '" data-product-image="' + esc(mainImg) + '" data-product-category="' + esc(p.category) + '">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg> Add to Cart</button>' +
                            '<button class="btn btn-secondary wishlist-btn" data-product-id="' + doc.id + '" data-product-name="' + esc(p.name) + '" data-product-price="' + (p.price || 0) + '" data-product-image="' + esc(mainImg) + '" data-product-category="' + esc(p.category) + '" aria-label="Add to Wishlist">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg></button>' +
                        '</div>' +
                        '<div class="trust-badges">' +
                            '<div class="trust-badge"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg><span>Silk Mark Certified</span></div>' +
                            '<div class="trust-badge"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg><span>Free Shipping</span></div>' +
                            '<div class="trust-badge"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 15v-1a4 4 0 00-4-4H8m0 0l3 3m-3-3l3-3m9 14V5a2 2 0 00-2-2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2z" /></svg><span>2-Day Returns</span> <a href="returns.html" style="font-size:0.7rem;color:#0d6157;text-decoration:underline;">Check Policy</a></div>' +
                        '</div>' +
                        '<a href="https://wa.me/917200123457?text=' + waText + '" class="whatsapp-inquiry" target="_blank">' +
                            '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654z" /></svg> Have questions? Chat with us on WhatsApp</a>' +
                        '<div style="margin-top:20px;padding:16px;background:#faf7f0;border:1px solid #e8dcc8;border-radius:8px;font-size:0.8rem;color:#6b5e4f;line-height:1.6;">' +
                            '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="vertical-align:-2px;margin-right:4px;"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' +
                            '<strong>Please Note:</strong> We strive to represent our sarees in their truest form. However, the actual colour may vary slightly due to photographic lighting or your monitor settings. The intricate handloom weave may also have slight irregularities, which are the hallmark of an authentic handcrafted product.' +
                        '</div>' +
                    '</div>' +
                '</div>';

                // Tab description
                document.getElementById('tabDescription').textContent = p.description || 'No description available.';
                document.getElementById('productTabsSection').style.display = '';

                // Wire up gallery thumbs
                document.querySelectorAll('.thumb').forEach(function(thumb) {
                    thumb.addEventListener('click', function() {
                        document.querySelectorAll('.thumb').forEach(function(t) { t.classList.remove('active'); });
                        this.classList.add('active');
                        document.getElementById('mainImage').src = this.dataset.src;
                    });
                });

                // Wire up tabs
                document.querySelectorAll('.tab-btn').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
                        document.querySelectorAll('.product-tabs-section .tab-content').forEach(function(c) { c.classList.remove('active'); });
                        this.classList.add('active');
                        document.getElementById(this.dataset.tab).classList.add('active');
                    });
                });

                // Quantity buttons
                var minusBtn = document.querySelector('.qty-btn.minus');
                var plusBtn = document.querySelector('.qty-btn.plus');
                if (minusBtn) minusBtn.addEventListener('click', function() { var inp = document.querySelector('.qty-input'); if (inp && inp.value > 1) inp.value = parseInt(inp.value) - 1; });
                if (plusBtn) plusBtn.addEventListener('click', function() { var inp = document.querySelector('.qty-input'); if (inp && inp.value < 10) inp.value = parseInt(inp.value) + 1; });

                // Add to cart
                var cartBtn = document.querySelector('.add-to-cart');
                if (cartBtn) {
                    cartBtn.addEventListener('click', function() {
                        var qty = parseInt(document.querySelector('.qty-input').value) || 1;
                        if (window.PremamCart) {
                            window.PremamCart.add({
                                id: doc.id,
                                name: p.name,
                                price: p.price,
                                image: mainImg,
                                category: p.category || ''
                            }, qty);
                        }
                    });
                }

                // Wishlist button
                var wishBtn = document.querySelector('.wishlist-btn');
                if (wishBtn) {
                    // Set initial state if already in wishlist
                    if (window.PremamWishlist && window.PremamWishlist.has(doc.id)) {
                        wishBtn.classList.add('active');
                        wishBtn.setAttribute('aria-label', 'Remove from Wishlist');
                    }
                    wishBtn.addEventListener('click', function() {
                        if (window.PremamWishlist) {
                            if (window.PremamWishlist.has(doc.id)) {
                                window.PremamWishlist.remove(doc.id);
                                wishBtn.classList.remove('active');
                                wishBtn.setAttribute('aria-label', 'Add to Wishlist');
                            } else {
                                window.PremamWishlist.add({
                                    id: doc.id,
                                    name: p.name,
                                    price: p.price,
                                    image: mainImg,
                                    category: p.category || ''
                                });
                                wishBtn.classList.add('active');
                                wishBtn.setAttribute('aria-label', 'Remove from Wishlist');
                            }
                        }
                    });
                }

                // Load related products (same category, excluding current)
                loadRelated(db, p.category, doc.id);

            }).catch(function(err) {
                console.error('Error loading product:', err);
                document.getElementById('productContent').innerHTML = '<p>Error loading product. <a href="shop.html">Browse all sarees</a></p>';
            });
        }

        function loadRelated(db, category, currentId) {
            if (!category) return;
            db.collection('products').where('category', '==', category).limit(5).get().then(function(snap) {
                var related = snap.docs.filter(function(d) { return d.id !== currentId; }).slice(0, 4);
                if (related.length === 0) return;

                var grid = document.getElementById('relatedGrid');
                grid.innerHTML = related.map(function(d) {
                    var r = d.data();
                    var img = r.image || (r.images && r.images[0]) || 'images/placeholder.png';
                    return '<a href="product.html?id=' + d.id + '" class="product-card" style="text-decoration:none;color:inherit;">' +
                        '<div class="product-image"><img src="' + esc(img) + '" alt="' + esc(r.name) + '" class="main-image"></div>' +
                        '<div class="product-info">' +
                            '<span class="product-category">' + esc(r.category) + '</span>' +
                            '<h4 class="product-name">' + esc(r.name) + '</h4>' +
                            '<div class="product-price"><span class="current">' + fmt(r.price) + '</span></div>' +
                        '</div></a>';
                }).join('');
                document.getElementById('relatedSection').style.display = '';
            }).catch(function() {});
        }

        document.addEventListener('DOMContentLoaded', function() { tryLoad(0); });
    })();
    </script>
</body>

</html>